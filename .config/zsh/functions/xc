#!/usr/bin/env zsh


# xc - Xcode wrapper function
function xc() {
    if [[ -f Package.swift ]]; then
        echo "Opening swift package"
        open Package.swift "$@"
        return
    fi

    # Find workspaces (ignore ones inside xcodeproj bundle)
    local workspaces=( $(find . -name "*.xcworkspace" -not -path "*/project.xcworkspace*" 2>/dev/null) )
    if [[ ${#workspaces[@]} -gt 0 ]]; then
        printf '%s\n' "${workspaces[@]}"
        if [[ -d "${workspaces[1]}" ]]; then
            echo "Opening first workspace"
            open "${workspaces[1]}" "$@"
            return
        fi
    fi

    # Find projects (ignore CocoaPods projects)
    local projects=( $(find . -name "*.xcodeproj" -not -name "Pods.xcodeproj" 2>/dev/null) )
    if [[ ${#projects[@]} -gt 0 ]]; then
        printf '%s\n' "${projects[@]}"
        if [[ -d "${projects[1]}" ]]; then
            echo "Opening first project"
            open "${projects[1]}" "$@"
            return
        fi
    fi

    echo "No Xcode projects found in the current directory."
    return 1
}
