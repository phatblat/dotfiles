#!/usr/bin/env zsh

# macos - Manage macOS system updates (converted from ðŸ–¥_macos)
function macos() {
    echo "ðŸ–¥  macOS"

    # Only install Rosetta 2 on M1 if not already installed
    if [[ "$(uname -m)" == "arm64" && ! -f "/Library/Apple/usr/share/rosetta/rosetta" ]]; then
        echo
        echo "ðŸŒ  Rosetta 2"
        sudo softwareupdate --install-rosetta
    fi

    echo
    echo "âŒ›ï¸  Recently installed macOS system updates"
    softwareupdate --history

    echo
    echo "ðŸ”Ž  Checking macOS system updates"
    softwareupdate --list

    echo
    echo "â¬†ï¸  Updating macOS system software"

    # Download all updates before install
    local output
    output=$(softwareupdate --download --all --no-scan 2>&1)

    # Exit when "No updates are available."
    if [[ -n "$output" ]]; then
        echo "$output"
        return
    fi

    # sudo will prompt for password allowing one way to avoid a restart
    sudo softwareupdate --install --all --no-scan --restart
}
