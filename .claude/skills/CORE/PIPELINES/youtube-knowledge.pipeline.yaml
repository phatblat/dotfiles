# ============================================================================
# PIPELINE: youtube-knowledge
# ============================================================================
#
# Extract knowledge from a YouTube video: transcript → analysis → structured output
#
# USAGE:
#   pai pipeline youtube-knowledge --url "https://youtube.com/watch?v=abc123"
#
# ============================================================================

name: youtube-knowledge
version: "1.0.0"
description: Extract and analyze knowledge from YouTube videos

# Pipeline input schema
input:
  url:
    type: string
    required: true
    description: YouTube video URL
  domain:
    type: string
    enum: [security, business, research, wisdom, general]
    description: Focus domain (auto-detected if not specified)
  extractQuotes:
    type: boolean
    default: true
    description: Extract notable quotes

# Pipeline output schema
output:
  transcript:
    type: string
    description: Full video transcript
  knowledge:
    type: object
    description: Extracted knowledge structure
  videoId:
    type: string
    description: YouTube video ID

# Step definitions
steps:
  # Step 1: Extract transcript from YouTube
  - id: extract
    action: extract/youtube
    input:
      url: "{{input.url}}"
      pattern: extract_wisdom

  # Step 2: Analyze and extract knowledge
  - id: analyze
    action: extract/knowledge
    input:
      content: "{{steps.extract.output.transcript}}"
      domain: "{{input.domain}}"
      extractQuotes: "{{input.extractQuotes}}"

  # Step 3: Format as markdown report
  - id: format
    action: format/markdown
    input:
      content:
        source: "{{input.url}}"
        videoId: "{{steps.extract.output.videoId}}"
        domain: "{{steps.analyze.output.domain}}"
        summary: "{{steps.analyze.output.summary}}"
        insights: "{{steps.analyze.output.insights}}"
        signals: "{{steps.analyze.output.signals}}"
        recommendations: "{{steps.analyze.output.recommendations}}"
        quotes: "{{steps.analyze.output.quotes}}"
        rating: "{{steps.analyze.output.rating}}"
      template: report
      title: "Knowledge Extraction: {{steps.analyze.output.domain}}"

# Final output mapping
output_mapping:
  transcript: "{{steps.extract.output.transcript}}"
  knowledge:
    summary: "{{steps.analyze.output.summary}}"
    domain: "{{steps.analyze.output.domain}}"
    insights: "{{steps.analyze.output.insights}}"
    signals: "{{steps.analyze.output.signals}}"
    recommendations: "{{steps.analyze.output.recommendations}}"
    quotes: "{{steps.analyze.output.quotes}}"
    rating: "{{steps.analyze.output.rating}}"
    confidence: "{{steps.analyze.output.confidence}}"
  videoId: "{{steps.extract.output.videoId}}"
  report: "{{steps.format.output.markdown}}"
