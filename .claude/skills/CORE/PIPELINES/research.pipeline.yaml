# ============================================================================
# PIPELINE: research
# ============================================================================
#
# Multi-step research pipeline that parses a topic, generates queries,
# searches, and synthesizes results into a report.
#
# USAGE:
#   pai pipeline research --topic "quantum computing"
#
# This pipeline demonstrates:
#   - Sequential step execution
#   - Variable interpolation with {{}}
#   - Output chaining between steps
#
# ============================================================================

name: research
version: "1.0.0"
description: Research a topic and produce a structured report

# Pipeline input schema
input:
  topic:
    type: string
    required: true
    description: The topic to research
  depth:
    type: number
    default: 3
    description: Number of search queries to generate

# Pipeline output schema
output:
  report:
    type: string
    description: The final markdown report
  sources:
    type: array
    description: URLs and references used

# Step definitions
steps:
  # Step 1: Parse the topic into structured form
  - id: parse
    action: parse/topic
    input:
      text: "{{input.topic}}"

  # Step 2: Generate search queries from the parsed topic
  # TODO: Create search/generate-queries action
  # - id: queries
  #   action: search/generate-queries
  #   input:
  #     topic: "{{steps.parse.output.name}}"
  #     subtopics: "{{steps.parse.output.subtopics}}"
  #     count: "{{input.depth}}"

  # Step 3: Search (parallel execution across queries)
  # TODO: Create search/web action
  # - id: search
  #   action: search/web
  #   parallel: true
  #   foreach: "{{steps.queries.output.queries}}"
  #   input:
  #     query: "{{item}}"

  # Step 4: Summarize the results
  - id: summarize
    action: transform/summarize
    input:
      text: "Research topic: {{steps.parse.output.name}}. Subtopics: {{steps.parse.output.subtopics | join: ', '}}. Keywords: {{steps.parse.output.keywords | join: ', '}}."
      targetWords: 200
      style: detailed

  # Step 5: Format as markdown report
  - id: format
    action: format/markdown
    input:
      content:
        topic: "{{steps.parse.output.name}}"
        subtopics: "{{steps.parse.output.subtopics}}"
        keywords: "{{steps.parse.output.keywords}}"
        summary: "{{steps.summarize.output.summary}}"
      template: report
      title: "Research: {{steps.parse.output.name}}"

# Final output mapping
output_mapping:
  report: "{{steps.format.output.markdown}}"
  sources: []  # TODO: Populate from search step
