# ============================================================================
# PIPELINE: blog-publish
# ============================================================================
#
# Complete blog publishing pipeline: draft → proofread → validate → enhance → output
#
# USAGE:
#   pai pipeline blog-publish --topic "AI in 2025" --style narrative
#
# This pipeline chains blog actions to produce a publish-ready blog post.
#
# ============================================================================

name: blog-publish
version: "1.0.0"
description: Generate, refine, and prepare a blog post for publishing

# Pipeline input schema
input:
  topic:
    type: string
    required: true
    description: The topic to write about
  style:
    type: string
    enum: [technical, narrative, tutorial, opinion]
    default: narrative
    description: Writing style
  targetWords:
    type: number
    default: 1000
    description: Target word count
  outline:
    type: array
    description: Optional section headings

# Pipeline output schema
output:
  post:
    type: string
    description: Final publish-ready blog post with frontmatter
  seo:
    type: object
    description: SEO metadata
  validation:
    type: object
    description: Validation results

# Step definitions
steps:
  # Step 1: Generate the draft
  - id: draft
    action: blog/write-draft
    input:
      topic: "{{input.topic}}"
      style: "{{input.style}}"
      targetWords: "{{input.targetWords}}"
      outline: "{{input.outline}}"

  # Step 2: Proofread for errors
  - id: proofread
    action: blog/proofread
    input:
      content: "{{steps.draft.output.draft}}"

  # Step 3: Validate structure and links
  - id: validate
    action: blog/validate
    input:
      content: "{{steps.proofread.output.corrected}}"
      minWords: "{{input.targetWords | times: 0.8}}"

  # Step 4: Enhance with SEO and social metadata
  - id: enhance
    action: blog/enhance
    input:
      content: "{{steps.proofread.output.corrected}}"

# Final output mapping
output_mapping:
  post: "{{steps.enhance.output.enhanced}}"
  seo: "{{steps.enhance.output.seo}}"
  validation:
    valid: "{{steps.validate.output.valid}}"
    warnings: "{{steps.validate.output.warnings}}"
    stats: "{{steps.validate.output.stats}}"
