# Reconnaissance Workflow

## Overview
Reconnaissance is Phase 1 of the penetration testing methodology - the critical asset discovery and information gathering phase.

## Goals
- Discover all assets in scope (subdomains, IPs, ports, services)
- Identify technologies and frameworks
- Map attack surface
- Gather intelligence for later phases

## Passive Reconnaissance (OSINT)

### DNS Information
- **whois** - Domain registration info
- **dig** - DNS records (A, AAAA, MX, TXT, NS)
- **Certificate Transparency logs** - crt.sh, censys.io

### Search Engine Reconnaissance
- Google dorking for exposed information
- GitHub/GitLab code search for credentials
- Pastebin/leak databases

### Third-Party Services
- Shodan - Internet-connected devices
- Censys - Internet-wide scanning data
- BuiltWith - Technology profiling

## Active Reconnaissance

### Subdomain Enumeration
```bash
# Using subfinder
subfinder -d target.com -o subdomains.txt

# Using amass
amass enum -d target.com -o amass_output.txt

# Using DNS brute force
dnsrecon -d target.com -D wordlist.txt -t brt
```

### Port Scanning
```bash
# Quick scan of top ports
nmap -F target.com

# Full port scan
nmap -p- target.com

# Service version detection
nmap -sV -p 80,443,8080 target.com

# OS detection
nmap -O target.com
```

### Service Fingerprinting
- HTTP headers analysis
- SSL/TLS certificate inspection
- Banner grabbing
- Technology stack identification

### Content Discovery
```bash
# Using ffuf
ffuf -u https://target.com/FUZZ -w wordlist.txt

# Using gobuster
gobuster dir -u https://target.com -w wordlist.txt

# Using dirsearch
dirsearch -u https://target.com -w wordlist.txt
```

## Tools

### Essential Recon Tools
- **subfinder** - Subdomain discovery
- **amass** - Network mapping & asset discovery
- **nmap** - Port scanning & service detection
- **ffuf** - Fast web fuzzing
- **gobuster** - Directory/file brute forcing
- **whatweb** - Web technology fingerprinting
- **wafw00f** - WAF detection

### Supporting Tools
- **dig/host** - DNS queries
- **whois** - Domain information
- **shodan** - Internet-connected device search
- **censys** - Certificate and host discovery
- **theHarvester** - Email and subdomain gathering

## Output Organization

### Directory Structure
```
recon/
├── domains/
│   ├── subdomains.txt
│   ├── resolved_ips.txt
│   └── dns_records.txt
├── ports/
│   ├── nmap_scans/
│   └── service_versions.txt
├── web/
│   ├── technologies.txt
│   ├── directories.txt
│   └── parameters.txt
└── intelligence/
    ├── emails.txt
    ├── credentials.txt
    └── leaked_data.txt
```

## Best Practices

1. **Start passive** - Gather OSINT before touching target systems
2. **Document everything** - Save all command outputs and results
3. **Respect scope** - Only test authorized targets
4. **Rate limiting** - Don't overwhelm target systems
5. **Multiple sources** - Cross-reference findings across tools
6. **Continuous process** - Recon throughout entire assessment

## Integration with Other Phases

### Feeds into Mapping (Phase 2)
- Discovered subdomains → Content discovery
- Open ports → Service-specific testing
- Technologies → Targeted vulnerability testing

### Feeds into Exploitation (Phases 3-4)
- Exposed services → Attack vectors
- Leaked credentials → Authentication bypass
- Technology versions → Known vulnerability exploitation

## Common Pitfalls

- ❌ Insufficient subdomain enumeration
- ❌ Skipping certificate transparency logs
- ❌ Not checking for cloud storage (S3, Azure Blob, etc.)
- ❌ Forgetting to check alternative TLDs
- ❌ Missing API endpoints and hidden parameters

## Automation

### Recon Automation Script Example
```bash
#!/bin/bash
DOMAIN=$1

# Subdomain enumeration
subfinder -d $DOMAIN -o subdomains.txt
amass enum -d $DOMAIN -o amass.txt
cat subdomains.txt amass.txt | sort -u > all_subdomains.txt

# Port scanning
nmap -iL all_subdomains.txt -oA nmap_scan

# Web technology fingerprinting
cat all_subdomains.txt | while read subdomain; do
    whatweb $subdomain >> technologies.txt
done

# Content discovery (top subdomains only)
head -20 all_subdomains.txt | while read subdomain; do
    ffuf -u https://$subdomain/FUZZ -w wordlist.txt -o ffuf_$subdomain.json
done
```

## Reference

See full methodology: `~/.claude/skills/Webassessment/Workflows/pentest/Master-methodology.md`
